<nb-card class="col-md-10 m-auto" [nbSpinner]="loadingData"
  [nbSpinnerSize]="'giant'" [nbSpinnerMessage]="'Cargando información'"
  [nbSpinnerStatus]="'primary'">

  <nb-card-header>
    <h5 class="text-white">Formulario de registro para empleados</h5>
  </nb-card-header>

  <nb-card-body>
    <form [formGroup]="form" (submit)="formSubmit();">
      <div class="row">
        <!-- IMAGEN -->
        <div class="col-md-3">
          <app-file-upload formControlName="perfil"
            [text]="'Ejemplo de documento'" [name]="'perfil'"
            [status]="validatorInput('perfil', form)"
            [templateRef]="templateRef" [popoverError]="nbPopoverError"
            (change)="nbPopoverError = getError('perfil', form);">
          </app-file-upload>
        </div>

        <div class="col-md-9">
          <div class="row">
            <div class="col-md-4">
              <p><strong>Datos de usuario</strong></p>
              <!-- CORREO ELECTRONICO -->
              <div class="form-group mt-0">
                <label class="label">Correo Electronico</label>
                <input placeholder="Correo del alumno" type="text" nbInput
                  fullWidth formControlName="email" shape="rectangle"
                  [nbPopover]="templateRef"
                  [nbPopoverTrigger]="nbPopoverTrigger"
                  [shape]="nbComponentShape"
                  [nbPopoverContext]="{ text: nbPopoverError }"
                  (keyup)="nbPopoverError = getError('email', form);"
                  (focus)="nbPopoverError = getError('email', form);"
                  [status]="validatorInput('email', form)">
              </div>
              <!-- PASSWORD -->
              <div class="form-group mt-0">
                <label class="label">Contraseña</label>
                <input placeholder="Contraseña de usuario" type="password"
                  nbInput fullWidth formControlName="password" shape="rectangle"
                  [nbPopover]="templateRef"
                  [nbPopoverTrigger]="nbPopoverTrigger"
                  [shape]="nbComponentShape"
                  [nbPopoverContext]="{ text: nbPopoverError }"
                  (keyup)="nbPopoverError = getError('password', form);"
                  (focus)="nbPopoverError = getError('password', form);"
                  [status]="validatorInput('password', form)">
              </div>
              <!-- ROL -->
              <div class="form-group mt-0">
                <label class="label">Rol del usuario</label>
                <nb-select formControlName="rol" fullWidth shape="rectangle"
                  [nbPopover]="templateRef"
                  [nbPopoverTrigger]="nbPopoverTrigger"
                  [shape]="nbComponentShape"
                  [nbPopoverContext]="{ text: nbPopoverError }"
                  (keyup)="nbPopoverError = getError('rol', form);"
                  (focus)="nbPopoverError = getError('rol', form);"
                  [status]="validatorInput('rol', form)">

                  <nb-option [value]="''">Seleccione Unidad Académica
                  </nb-option>

                  <nb-option *ngFor="let rol of roles" [value]="rol.value">
                    {{ rol.text }}
                  </nb-option>
                </nb-select>
              </div>
            </div>

            <div class="col-md-8">
              <p class="ml-3"><strong>Datos de empleado</strong></p>
              <!-- NOMBRE COMPLETO -->
              <div class="row col-md-12">
                <!--NOMBRE-->
                <div class="form-group col-md-4 mt-0">
                  <label class="label">Nombre(s)</label>
                  <input placeholder="Nombre(s)" type="text" nbInput fullWidth
                    formControlName="nombre" shape="rectangle"
                    [nbPopover]="templateRef"
                    [nbPopoverTrigger]="nbPopoverTrigger"
                    [shape]="nbComponentShape"
                    [nbPopoverContext]="{ text: nbPopoverError }"
                    (keyup)="nbPopoverError = getError('nombre', form);"
                    (focus)="nbPopoverError = getError('nombre', form);"
                    [status]="validatorInput('nombre', form)">
                </div>
                <!--APE_1 -->
                <div class="form-group col-md-4 mt-0">
                  <label class="label">Primer apellido</label>
                  <input placeholder="Primer apellido" type="text" nbInput
                    fullWidth formControlName="ape_1" shape="rectangle"
                    [nbPopover]="templateRef"
                    [nbPopoverTrigger]="nbPopoverTrigger"
                    [shape]="nbComponentShape"
                    [nbPopoverContext]="{ text: nbPopoverError }"
                    (keyup)="nbPopoverError = getError('ape_1', form);"
                    (focus)="nbPopoverError = getError('ape_1', form);"
                    [status]="validatorInput('ape_1', form)">
                </div>
                <!-- APE_2 -->
                <div class="form-group col-md-4 mt-0">
                  <label class="label">Segundo apellido</label>
                  <input placeholder="Segundo apellido" type="text" nbInput
                    fullWidth formControlName="ape_2" shape="rectangle"
                    [nbPopover]="templateRef"
                    [nbPopoverTrigger]="nbPopoverTrigger"
                    [shape]="nbComponentShape"
                    [nbPopoverContext]="{ text: nbPopoverError }"
                    (keyup)="nbPopoverError = getError('ape_2', form);"
                    (focus)="nbPopoverError = getError('ape_2', form);"
                    [status]="validatorInput('ape_2', form)">
                </div>
              </div>
              <!-- EMAIL TELEFONO -->
              <div class="row col-md-12">
                <!-- CORREO ELECTRONICO -->
                <div class="form-group col-md-6 mt-0">
                  <label class="label">Correo Electronico</label>
                  <input placeholder="Correo del alumno" type="text" nbInput
                    fullWidth formControlName="email" shape="rectangle"
                    [nbPopover]="templateRef"
                    [nbPopoverTrigger]="nbPopoverTrigger"
                    [shape]="nbComponentShape"
                    [nbPopoverContext]="{ text: nbPopoverError }"
                    (keyup)="nbPopoverError = getError('email', form);"
                    (focus)="nbPopoverError = getError('email', form);"
                    [status]="validatorInput('email', form)">
                </div>
                <!-- TELEFONO -->
                <div class="form-group col-md-6 mt-0">
                  <label class="label">Telefono</label>
                  <input placeholder="Telefono del alumno" type="text" nbInput
                    fullWidth formControlName="telefono" shape="rectangle"
                    [nbPopover]="templateRef"
                    [nbPopoverTrigger]="nbPopoverTrigger"
                    [shape]="nbComponentShape"
                    [nbPopoverContext]="{ text: nbPopoverError }"
                    (keyup)="nbPopoverError = getError('telefono', form);"
                    (focus)="nbPopoverError = getError('telefono', form);"
                    [status]="validatorInput('telefono', form)">
                </div>
              </div>
              <!-- UNIDAD ACADEMICA -->
              <div class="row col-md-12">
                <!-- UNIDAD ACADEMICA -->
                <div class="form-group col-md-12 mt-0">
                  <label class="label">Unidad Academica</label>
                  <nb-select formControlName="idunidad" fullWidth
                    shape="rectangle" [nbPopover]="templateRef"
                    [nbPopoverTrigger]="nbPopoverTrigger"
                    [shape]="nbComponentShape"
                    [nbPopoverContext]="{ text: nbPopoverError }"
                    (keyup)="nbPopoverError = getError('idunidad', form);"
                    (focus)="nbPopoverError = getError('idunidad', form);"
                    [status]="validatorInput('idunidad', form)">

                    <nb-option [value]="''">Seleccione Unidad Académica
                    </nb-option>

                    <nb-option *ngFor="let g of unidades_academicas"
                      [value]="g.idunidad">
                      Clave: {{ g.clave }}, {{ g.nombre }}
                    </nb-option>
                  </nb-select>
                </div>
              </div>
            </div>
          </div>

          <div class="row col-md-12 justify-content-end">
            <!-- SUBMIT -->
            <button nbButton [disabled]="form.invalid" [status]="valid"
              [size]="'medium'" type="submit">
              Registar empleado
            </button>
          </div>
        </div>

      </div>
    </form>
  </nb-card-body>
</nb-card>

<!-- Template para los popovers -->
<ng-template #templateRef let-data>
  <div *ngIf="nbPopoverError !== ''" class="bg-danger rounded p-2"
    style="max-width: 18rem;">
    <strong class="text-white text-justify">
      {{ data.text }}
    </strong>
  </div>
</ng-template>